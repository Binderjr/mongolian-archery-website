<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Монгол бичиг</title>
  <style>
    :root{
      --gap:14px;
      --bg:#f5f5f7;
      --card:#ffffff;
      --ink:#111;
      --accent:#111827;
      --radius:14px;
    }

    body{
      margin:0;
      font-family:Inter,Roboto,Arial,system-ui;
      background:var(--bg);
      color:var(--ink);
    }

    /* --- Responsive Modern Layout --- */
    .hero{
      width:100%;
      max-width:1200px;
      margin:20px auto;
      padding:16px;
      display:flex;
      gap:24px;
      align-items:flex-start;
      flex-wrap:wrap;
    }

    .grids-wrap{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:28px;
      min-width:300px;
    }

    .pixel-container{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:0 6px 20px rgba(0,0,0,0.07);
      display:flex;
      flex-direction:column;
      align-items:center;
      transition:transform .15s ease;
    }
    .pixel-container:hover{
      transform:translateY(-2px);
    }

    .pixel-grid{
      width:100%;
      max-width:340px;
      aspect-ratio:1/1;
      display:grid;
      grid-template-columns:repeat(13, minmax(0,1fr));
      grid-auto-rows:1fr;
      gap:1px;
      background:#ddd;
      padding:6px;
      border-radius:var(--radius);
      box-sizing:border-box;
    }

    .pixel{
      background:#fff;
      border-radius:4px;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,0.06);
      user-select:none;
      touch-action:none;
      transition:background 0.1s ease;
    }
    .pixel.active{
      background:var(--accent);
    }

    .controls{
      display:flex;
      gap:8px;
      margin-top:12px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .btn{
      padding:8px 12px;
      background:var(--accent);
      border:none;
      border-radius:10px;
      color:#fff;
      cursor:pointer;
      font-size:13px;
    }

    .grid-header{
      margin:0 0 10px 0;
      font-size:1.1rem;
      font-weight:600;
    }

    /* --- Floating Modern Navigation --- */
    #navigatorToggle{
      position:fixed;
      top:18px;
      right:18px;
      z-index:50;
      padding:10px 16px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,0.25);
    }

    #gridNav{
      position:fixed;
      top:70px;
      right:20px;
      background:rgba(255,255,255,0.98);
      padding:12px;
      box-shadow:0 8px 25px rgba(0,0,0,0.15);
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      z-index:40;
      border-radius:16px;
      max-height:0;
      opacity:0;
      overflow:hidden;
      transition:max-height .3s ease, opacity .3s ease;
    }

    #gridNav a{
      width:34px;
      height:34px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:8px;
      background:#f1f1f1;
      color:#222;
      text-decoration:none;
      font-size:14px;
      font-weight:600;
      transition:background .15s ease, transform .15s ease;
    }

    #gridNav a:hover{
      background:var(--accent);
      color:#fff;
      transform:translateY(-2px);
    }

    /* --- Mobile Responsive Tweaks --- */
    @media (max-width:600px){
      #gridNav{
        right:10px;
        top:70px;
        transform:scale(0.9);
      }
      .pixel-grid{
        max-width:260px;
      }
      .hero{
        margin-top:80px;
      }
    }
  </style>
</head>
<body>
  <button id="navigatorToggle" style="position:fixed; top:20px; right:20px; z-index:40; padding:8px 14px; background:#111827; color:#fff; border:none; border-radius:10px; cursor:pointer; box-shadow:0 3px 12px rgba(0,0,0,0.25);">Navigator</button>
  <nav id="gridNav" style="position:fixed; top:20px; right:20px; background:#fff; padding:10px; box-shadow:0 4px 10px rgba(0,0,0,0.15); display:flex; flex-wrap:wrap; gap:6px; z-index:30; border-radius:10px; max-height:200px; transition:max-height 0.25s ease, opacity 0.25s ease; overflow:hidden;"></nav>
  <section class="hero">
    <div class="grids-wrap" id="gridsWrap" aria-live="polite"></div>

    <aside class="hero-text">
      <h1 class="text-2xl font-bold mb-4">Монгол бичиг</h1>
      <p class="small">Interactive 13×13 pixel зурлага — each tile is independently controllable. Click & drag to paint. Use controls below each grid.</p>
    </aside>
  </section>

  <script>
    (function(){
      const GRID_COUNT = 30;
      const ROWS = 13;
      const COLS = 13;

      function makeRandomPattern(fillChance = 0.25){
        const pat = [];
        for(let r=0;r<ROWS;r++){
          let row = '';
          for(let c=0;c<COLS;c++) row += Math.random() < fillChance ? '#' : '.';
          pat.push(row);
        }
        return pat;
      }

      function savePattern(id, gridEl){
        const pixels = Array.from(gridEl.querySelectorAll('.pixel'));
        const rows = [];
        for(let r=0;r<ROWS;r++){
          let row = '';
          for(let c=0;c<COLS;c++){
            const idx = r*COLS + c;
            row += pixels[idx].classList.contains('active') ? '#' : '.';
          }
          rows.push(row);
        }
        localStorage.setItem(`grid_${id}_pattern`, JSON.stringify(rows));
      }

      function loadPattern(id){
        const raw = localStorage.getItem(`grid_${id}_pattern`);
        if(!raw) return null;
        try { return JSON.parse(raw); } catch { return null; }
      }

      const gridsWrap = document.getElementById('gridsWrap');

      function createGridComponent(id, pattern){
        const container = document.createElement('div');
        container.id = `grid-${id}`;
        container.className = 'pixel-container';
        container.dataset.instanceId = id;
        container._initialPattern = pattern.slice();

        const header = document.createElement('h1');
        header.className = 'grid-header';
        header.textContent = `Зурлага ${id}`;

        const grid = document.createElement('div');
        grid.className = 'pixel-grid';

        for(let r=0;r<ROWS;r++){
          const rowStr = pattern[r] || '.'.repeat(COLS);
          for(let c=0;c<COLS;c++){
            const px = document.createElement('div');
            px.className = 'pixel';
            px.dataset.index = r*COLS + c;
            if(rowStr[c] === '#') px.classList.add('active');

            px.addEventListener('pointerdown', (e)=>{
              e.preventDefault();
              px.classList.toggle('active');
              savePattern(id, grid);
              updateBinaryValue();
              container._painting = true;
            });
            px.addEventListener('pointerenter', (e)=>{
              if(container._painting && (e.buttons & 1)){
                px.classList.add('active');
                savePattern(id, grid);
              updateBinaryValue();
              }
            });
            px.addEventListener('pointerup', ()=>{
              container._painting = false;
              savePattern(id, grid);
              updateBinaryValue();
            });

            grid.appendChild(px);
          }
        }

        document.addEventListener('pointerup', ()=>{ container._painting = false; });

        const controls = document.createElement('div');
        controls.className = 'controls';

        function btn(text){ const b=document.createElement('button'); b.className='btn'; b.textContent=text; return b; }

        const clearBtn = btn('Clear');
        const invertBtn = btn('Invert');
        const exportBtn = btn('Export PNG');
        const reloadBtn = btn('Reload');

        const valueBox = document.createElement('div');
        valueBox.className = 'small';
        valueBox.style.marginTop = '6px';
        valueBox.textContent = '';

        function updateBinaryValue(){
          const pixels = grid.querySelectorAll('.pixel');
          let bin = '';
          pixels.forEach(p=>{ bin += p.classList.contains('active') ? '1' : '0'; });
          valueBox.textContent = 'Binary: ' + bin;
        }

        updateBinaryValue();

        controls.append(clearBtn, invertBtn, exportBtn, reloadBtn);

        clearBtn.addEventListener('click', ()=>{
          grid.querySelectorAll('.pixel').forEach(p=>p.classList.remove('active'));
          savePattern(id, grid);
              updateBinaryValue();
        });

        invertBtn.addEventListener('click', ()=>{
          grid.querySelectorAll('.pixel').forEach(p=>p.classList.toggle('active'));
          savePattern(id, grid);
              updateBinaryValue();
        });

        exportBtn.addEventListener('click', ()=>{
          exportGridToPNG(grid, id);
        });

        reloadBtn.addEventListener('click', ()=>{
          const ip = container._initialPattern;
          const pixels = grid.querySelectorAll('.pixel');
          for(let r=0;r<ROWS;r++){
            for(let c=0;c<COLS;c++){
              const idx = r*COLS + c;
              if(ip[r][c] === '#') pixels[idx].classList.add('active');
              else pixels[idx].classList.remove('active');
            }
          }
          savePattern(id, grid);
              updateBinaryValue();
        });

        container.appendChild(header);

// --- Wrap grid + explanation side by side ---
const rowWrap = document.createElement('div');
rowWrap.style.display = 'flex';
rowWrap.style.alignItems = 'flex-start';
rowWrap.style.gap = '24px';
rowWrap.style.width = '100%';
rowWrap.style.justifyContent = 'center';
rowWrap.style.flexWrap = 'wrap';

// Explanation box
const explain = document.createElement('div');
explain.style.flex = '1';
explain.style.minWidth = '200px';
explain.style.maxWidth = '280px';
explain.style.background = 'var(--card)';
explain.style.padding = '14px';
explain.style.borderRadius = 'var(--radius)';
explain.style.boxShadow = '0 6px 20px rgba(0,0,0,0.07)';
explain.innerHTML = `
  <div style="font-weight:600; margin-bottom:6px; font-size:1rem;">Тайлбар</div>
  <div class="explain-text" style="font-size:0.9rem; opacity:0.85; line-height:1.4rem;">
    Зурлага ${id}-ийн утгыг энд тайлбарлана.
  </div>
`;

rowWrap.appendChild(grid);
rowWrap.appendChild(explain);

container.appendChild(rowWrap);
container.appendChild(controls);
return container;
      }

      function exportGridToPNG(gridElement, id){
        const pixels = Array.from(gridElement.querySelectorAll('.pixel'));
        const canvas = document.createElement('canvas');
        canvas.width = COLS;
        canvas.height = ROWS;
        const ctx = canvas.getContext('2d');
        pixels.forEach((p,i)=>{
          const x = i % COLS, y = Math.floor(i / COLS);
          ctx.fillStyle = p.classList.contains('active') ? '#111827' : '#ffffff';
          ctx.fillRect(x,y,1,1);
        });
        const scale = 20;
        const scaled = document.createElement('canvas');
        scaled.width = COLS * scale;
        scaled.height = ROWS * scale;
        const sctx = scaled.getContext('2d');
        sctx.imageSmoothingEnabled = false;
        sctx.drawImage(canvas,0,0,scaled.width,scaled.height);
        const a=document.createElement('a');
        a.download = `pixel-art-${id}.png`;
        a.href = scaled.toDataURL('image/png');
        a.click();
      }

      const nav = document.getElementById('gridNav');
      const navToggle = document.getElementById('navigatorToggle');
      let navOpen = true;
      nav.style.maxHeight = '200px';
      navToggle.addEventListener('click', ()=>{
        navOpen = !navOpen;
        if(navOpen){nav.style.maxHeight='200px'; nav.style.opacity='1';}
        else{nav.style.maxHeight='0'; nav.style.opacity='0';}
      });

      const instances = [];
      for(let i=0;i<GRID_COUNT;i++){
        let pat = loadPattern(i+1);
        if(!pat) pat = makeRandomPattern(0.25);
        const comp = createGridComponent(i+1, pat);
        gridsWrap.appendChild(comp);

        const link = document.createElement('a');
        link.href = `#grid-${i+1}`;
        link.textContent = i+1;
        link.style.padding='4px 6px';
        link.style.border='1px solid #ccc';
        link.style.borderRadius='4px';
        link.style.fontSize='12px';
        link.style.textDecoration='none';
        link.style.color='#111';
        nav.appendChild(link);

        instances.push({el: comp, pattern: pat});
      }

      window.__pixelGrids = {instances, ROWS, COLS};
    })();
  </script>
</body>
</html>
